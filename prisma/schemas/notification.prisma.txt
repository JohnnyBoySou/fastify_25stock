/// ===============================
///  NOTIFICATION STRUCTURE
///  - Sistema unificado de notificações.
///  - Cada notificação pertence a um usuário e loja.
///  - Pode ser enviada via vários canais (push, email, sms).
///  - Base para alertas automáticos, workflows e IA.
/// ===============================

model Notification {
  id           String               @id @default(cuid())

  // Associação principal
  userId       String
  user         User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  storeId      String?
  store        Store?               @relation(fields: [storeId], references: [id], onDelete: SetNull)

  // Conteúdo
  title        String
  message      String
  type         NotificationType     @default(INFO)
  priority     NotificationPriority @default(MEDIUM)

  // Estado de leitura
  isRead       Boolean              @default(false)
  readAt       DateTime?

  // Entrega e canais
  channel      NotificationChannel  @default(IN_APP)
  sentAt       DateTime?
  deliveredAt  DateTime?
  deliveryError String?

  // Expiração e ação
  actionUrl    String?
  expiresAt    DateTime?
  data         Json? // dados adicionais (ex: { productId, movementId, severity })

  // Auditoria e controle
  deletedAt    DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("notifications")

  // Índices
  @@index([userId])
  @@index([storeId])
  @@index([type])
  @@index([isRead])
  @@index([priority])
  @@index([createdAt])
  @@schema("notification")
}

enum NotificationType {
  INFO          // Informação geral
  SUCCESS       // Sucesso/confirmação
  WARNING       // Aviso ou atenção
  ERROR         // Erro ou falha
  STOCK_ALERT   // Alerta de estoque baixo
  MOVEMENT      // Movimentação de estoque
  PERMISSION    // Permissão / acesso
  SYSTEM        // Sistema / manutenção
  BILLING       // Assinatura, cobrança, pagamento
  WORKFLOW      // Fluxo automatizado
  @@schema("notification")
}

enum NotificationPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
  @@schema("notification")
}

enum NotificationChannel {
  IN_APP     // Notificação interna do app
  PUSH       // Push Notification
  EMAIL      // E-mail
  SMS        // SMS
  SYSTEM     // Notificação do sistema
  @@schema("notification")
}
